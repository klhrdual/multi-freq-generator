<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Generator Pro</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent: #00e676; /* Ëû¢ÂÖâÁ∂†ÔºåÊõ¥ÊúâÁßëÊäÄÊÑü */
            --danger: #ff4081;
            --input-bg: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        h1 {
            text-align: center;
            font-weight: 200;
            letter-spacing: 1px;
            margin-bottom: 30px;
            color: #fff;
        }

        .controls-top {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: space-between;
            margin-bottom: 25px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: transform 0.1s, opacity 0.2s;
            color: #000;
        }
        
        button:active { transform: scale(0.98); }
        button:hover { opacity: 0.9; }

        .btn-play { background-color: var(--accent); color: #000; }
        .btn-stop { background-color: var(--danger); color: #fff; display: none; }
        .btn-add { background-color: #2979ff; color: #fff; }
        .btn-copy { background-color: #424242; color: #fff; border: 1px solid #555; }

        .oscillator-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .osc-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 20px;
            border-left: 4px solid var(--accent);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 120px;
        }

        label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #888;
            margin-bottom: 6px;
        }

        input[type="number"], select {
            background: var(--input-bg);
            border: 1px solid #444;
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 16px;
            outline: none;
        }
        
        input[type="number"]:focus, select:focus {
            border-color: var(--accent);
        }

        input[type="range"] {
            cursor: pointer;
            accent-color: var(--accent);
            height: 6px;
            background: #555;
            border-radius: 3px;
            appearance: none; 
        }

        .btn-remove {
            background: transparent;
            border: 1px solid #555;
            color: #888;
            padding: 8px 12px;
            font-size: 14px;
        }
        .btn-remove:hover {
            border-color: var(--danger);
            color: var(--danger);
            background: rgba(255, 64, 129, 0.1);
        }

        .status-bar {
            margin-top: 25px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            color: var(--accent);
            background: rgba(0, 230, 118, 0.1);
            opacity: 0;
            transition: opacity 0.3s;
        }

        @media (max-width: 600px) {
            .osc-card { gap: 15px; }
            .btn-group { width: 100%; }
            button { flex: 1; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Audio Generator <span style="font-size:0.5em; opacity:0.5">PRO</span></h1>
    
    <div class="controls-top">
        <div class="btn-group">
            <button id="playBtn" class="btn-play">‚ñ∂ Êí≠Êîæ Play</button>
            <button id="stopBtn" class="btn-stop">‚ñ† ÂÅúÊ≠¢ Stop</button>
        </div>
        <div class="btn-group">
            <button id="addBtn" class="btn-add">+ Êñ∞Â¢û Add</button>
            <button id="copyBtn" class="btn-copy">üîó Ë§áË£ΩÁ∂≤ÂùÄ Copy Link</button>
        </div>
    </div>

    <div id="oscillatorList" class="oscillator-list"></div>
    <div id="statusBar" class="status-bar">ÈÄ£ÁµêÂ∑≤Ë§áË£Ω Link Copied</div>
</div>

<script>
    // --- Ê†∏ÂøÉËÆäÊï∏ ---
    let audioCtx = null;
    let activeNodes = [];
    let isPlaying = false;
    
    // È†êË®≠Ë®≠ÂÆö [È†ªÁéá, Ê≥¢ÂΩ¢‰ª£Á¢º, Èü≥Èáè]
    // Ê≥¢ÂΩ¢‰ª£Á¢ºÂ∞çÁÖß: 0=sine, 1=square, 2=sawtooth, 3=triangle
    let settings = [
        { freq: 440, type: 0, vol: 0.5 } 
    ];

    const typeMap = ['sine', 'square', 'sawtooth', 'triangle']; // Áî®Êñº AudioNode
    const typeLabels = ['Ê≠£Âº¶Ê≥¢ (Sine)', 'ÊñπÊ≥¢ (Square)', 'Èã∏ÈΩíÊ≥¢ (Saw)', '‰∏âËßíÊ≥¢ (Tri)']; // Áî®Êñº UI

    // --- DOM ÂÖÉÁ¥† ---
    const listEl = document.getElementById('oscillatorList');
    const playBtn = document.getElementById('playBtn');
    const stopBtn = document.getElementById('stopBtn');
    const addBtn = document.getElementById('addBtn');
    const copyBtn = document.getElementById('copyBtn');
    const statusBar = document.getElementById('statusBar');

    // --- ÂàùÂßãÂåñ ---
    function init() {
        loadFromHash();
        renderUI();
        window.addEventListener('hashchange', () => {
            loadFromHash();
            if(!isPlaying) renderUI();
        });
    }

    // --- Èü≥Ë®äÈÇèËºØ ---
    function initAudio() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }

    function play() {
        initAudio();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        stop(false);

        activeNodes = settings.map(s => {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = typeMap[s.type] || 'sine';
            osc.frequency.setValueAtTime(s.freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(s.vol * 0.3, audioCtx.currentTime); // Á∏ΩÈü≥ÈáèË°∞Ê∏õ‰ª•Èò≤ÁàÜÈü≥

            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            return { osc, gain };
        });

        isPlaying = true;
        updateBtns();
    }

    function stop(updateState = true) {
        activeNodes.forEach(n => {
            try { n.osc.stop(); n.osc.disconnect(); n.gain.disconnect(); } catch(e){}
        });
        activeNodes = [];
        if (updateState) {
            isPlaying = false;
            updateBtns();
        }
    }

    function updateBtns() {
        playBtn.style.display = isPlaying ? 'none' : 'block';
        stopBtn.style.display = isPlaying ? 'block' : 'none';
    }

    // --- UI Ê∏≤Êüì ---
    function renderUI() {
        listEl.innerHTML = '';
        settings.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = 'osc-card';
            
            // ÊßãÂª∫Ê≥¢ÂΩ¢ÈÅ∏È†Ö
